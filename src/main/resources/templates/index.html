<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Light Saber Shop</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/custom.css" rel="stylesheet">
<link rel="shortcut icon" type="image/png" href="/favicon.png"/>
<script type="text/javascript">	

	//Limiting setting menu just for admin 
	function checkMenu(){
		if(![[${#httpServletRequest.isUserInRole("JEDIMASTER")}]]){
			removeElement("jediMasterMenu");
			if(![[${#httpServletRequest.isUserInRole("USER")}]]){
				removeElement("logoutMenu");
				removeElement("saberListMenu");
			};
		};
		if([[${#httpServletRequest.isUserInRole("JEDIMASTER")}]] || [[${#httpServletRequest.isUserInRole("USER")}]]){
			removeElement("signUpMenu");
			removeElement("loginMenu");
			if([[${#httpServletRequest.isUserInRole("USER")}]]){
				getUser("Jedisabershop/user/single",'{"email":"'+document.getElementById("emailLabel").innerHTML+'"}');
			}else{
				document.getElementById("containerUser").innerHTML = "Welcome Master Jedi... That's honor to see you here..."
			}
		};
	};
	
	function generatePage(page){
		var container = document.getElementById("container");
		switch(page){
			case "XML List":
				var myObj, x;
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var header = document.createElement("H3");
						header.className="col-sm-12 text-center";
						container.appendChild(header);
						header.innerHTML  = "XML List Of Light Sabers";
						var div = document.createElement("DIV");
						div.className = "container-fluid";
						var textarea = document.createElement("TEXTAREA");
						textarea.className="form-control";
						// textarea.readOnly  = "true"; - This line can comment out for making text area editable
						textarea.rows = "30";
						textarea.style = "resize:none;"
						textarea.appendChild(document.createTextNode(this.responseText));
						div.appendChild(textarea);
						container.appendChild(div);						
					}
				};
				xhttp.open("GET", "http://localhost:8082/Jedisabershop/saber/xml");
				xhttp.setRequestHeader("Content-type", "application/xml");
				xhttp.send();
				break;
				
			case "XML File":
				var myObj, x;
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var element = document.createElement("A");
						element.setAttribute('href', 'data:application/xml;charset=utf-8,' + encodeURIComponent(this.responseText));
						element.setAttribute('download', 'LightSabers.xml');
						element.style.display = 'none';
						container.appendChild(element);
						element.click();
						container.removeChild(element);
					}
				};
				xhttp.open("GET", "http://localhost:8082/Jedisabershop/saber/xml");
				xhttp.setRequestHeader("Content-type", "application/xml");
				xhttp.send();
				break;	
				
			case"Add New Light Saber":
				var header = document.createElement("H3");
				header.className="col-sm-12 text-center";
				container.appendChild(header);
				header.innerHTML  = "Add New Light Saber Form";
				var divFormHorizontal = document.createElement("DIV");
				divFormHorizontal.className = "form-horizontal";
				function createFormInput(labelText, id, inputType){
					var divFormGroup = document.createElement("DIV");
					divFormGroup.className = "form-group";
					var label = document.createElement("LABEL");
					label.className = "col-sm-3 control-label";
					label.appendChild(document.createTextNode(labelText));
					divFormGroup.appendChild(label);
					var divInput = document.createElement("DIV");
					divInput.className = "col-sm-8";
					switch(id){
						default:
							var input = document.createElement("INPUT");
							input.className = "form-control";
							input.id = id + "_input";
							input.type = inputType;
							input.placeholder = labelText;
							divInput.appendChild(input);
							break;
							
						case "crystalSearch":
							var divInputGroup = document.createElement("DIV");
							divInputGroup.className = "input-group";
							var input = document.createElement("INPUT");
							input.className = "form-control";
							input.id = id;
							input.placeholder = "Search For Crystal";
							input.onkeyup = function(){filterCrystalListTable()};
							divInputGroup.appendChild(input);
							var divAddon = document.createElement("DIV");
							divAddon.className = "input-group-addon";
							var searchGlyphicon =  document.createElement("SPAN");
							searchGlyphicon.className = "glyphicon glyphicon-search";
							divAddon.appendChild(searchGlyphicon);
							divInputGroup.appendChild(divAddon);
							divInput.appendChild(divInputGroup);
							break;
						
						case "crystalTable":
							
							break;
					}
					divFormGroup.appendChild(divInput);
					divFormHorizontal.appendChild(divFormGroup);
				}
				function createCrystalTable(){
					var divFormGroup = document.createElement("DIV");
					divFormGroup.className = "form-group";
					var label = document.createElement("LABEL");
					label.className = "col-sm-3 control-label";
					label.appendChild(document.createTextNode("Crystals List"));
					divFormGroup.appendChild(label);
					var divInput = document.createElement("DIV");
					divInput.className = "col-sm-8 panel panel-default";
					divInput.style = "overflow-y:auto; height:150px;"
					var crystalTable =  document.createElement("TABLE");
					crystalTable.id = "crystalTable";
					crystalTable.className = "table table-striped table-condensed";
					var tableBody =  document.createElement("TBODY");
					crystalTable.appendChild(tableBody);
					var rowHeader =  document.createElement("TR");
					rowHeader.className = "header";
					var headerTexts = ["#","Name","Color","Power Usage","d"];
					for(x in headerTexts){
						var header =  document.createElement("TH");
						header.innerHTML = headerTexts[x];
						rowHeader.appendChild(header);
					}
					tableBody.appendChild(rowHeader);
					var myObj, x;
					var xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = function() {
						if (this.readyState == 4 && this.status == 200) {
							myObj = JSON.parse(this.responseText);
							for(x in myObj){
								var row =  document.createElement("TR");
								row.id = myObj[x].id + "_row";
								var columnRadio = document.createElement("TD");
								var radio = document.createElement("INPUT");
								radio.type = "radio";
								radio.name = "crystalRadio";
								radio.value = myObj[x].id;
								radio.id = myObj[x].id + "_radio";
								columnRadio.appendChild(radio);
								row.appendChild(columnRadio);
								var columnName =  document.createElement("TD");
								columnName.innerHTML = myObj[x].name;
								row.appendChild(columnName);
								var columnColor =  document.createElement("TD");
								columnColor.innerHTML = myObj[x].color;
								row.appendChild(columnColor);
								var columnPowerUsage =  document.createElement("TD");
								columnPowerUsage.innerHTML = myObj[x].powerUsageMultiplier;
								row.appendChild(columnPowerUsage);
								var columnStockPrice =  document.createElement("TD");
								columnStockPrice.innerHTML = myObj[x].stockPrice;
								row.appendChild(columnStockPrice);
								tableBody.appendChild(row);
							}
						}
					}
					xhttp.open("GET", "http://localhost:8082/Jedisabershop/crystal");
					xhttp.setRequestHeader("Content-type", "application/json");
					xhttp.send();
					
					
					
					divInput.appendChild(crystalTable);
					divFormGroup.appendChild(divInput);
					divFormHorizontal.appendChild(divFormGroup);
				}
				createFormInput("Light Saber's Name","name","text");
				createFormInput("Planet","planet","text");
				createFormInput("Avability","avability","number");
				createFormInput("Search For Crystal","crystalSearch","text");
				createCrystalTable();
				container.appendChild(divFormHorizontal);
				break;
		}
	}
	
	// This function is for filtering the crytals table as the input in the searchbox
	function filterCrystalListTable() {
		var input, filter, table, tr, td, i, x;
		input = document.getElementById("crystalSearch");
		filter = input.value.toUpperCase();
		table = document.getElementById("crystalTable");
		tr = table.getElementsByTagName("tr");
		
			for (i = 1; i < tr.length; i++) { //started from 1 because i don't want remove header
			var controller = 0;
			td = tr[i].getElementsByTagName("td");
			for(j = 1; j < td.length; j++){ //started from 1 because i don't want to check radio boxes
				alert(td.length + " - " + j);
				if (td[j]) {
					if (td[j].innerHTML.toUpperCase().indexOf(filter) > -1) {
						controller += 1 ;
						break;
					}
				}
			}
			if (controller > 0) {
				tr[i].style.display = "";
			} else {
				tr[i].style.display = "none";
			}
		}
	}
	
	//For getting user data (its working with post methode)
	function getUser(api,data) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				alert(this.responseText);
				var container = document.getElementById("containerUser");
				removeElement("emailLabel");
				container.innerHTML = "";
				myObj = JSON.parse(this.responseText);
				var roleLabel = document.createElement("LABEL");
				roleLabel.className = "margin-right-5";
				roleLabel.innerHTML = myObj.role;
				container.appendChild(roleLabel);
				var nameLabel = document.createElement("LABEL");
				nameLabel.innerHTML = myObj.name;
				nameLabel.className = "margin-right-5";
				container.appendChild(nameLabel);
				if(myObj.dissolvedInForce){
					var seperator = document.createElement("LABEL");
					seperator.innerHTML = "  -  ";
					seperator.className = "margin-right-5";
					container.appendChild(seperator);
					var dissolvedLabel = document.createElement("LABEL");
					dissolvedLabel.innerHTML = "Dissolved in force";
					container.appendChild(dissolvedLabel);
					var div = document.createElement("DIV");
					div.className="row";
					container.appendChild(div);
					var restLabel = document.createElement("LABEL");
					restLabel.innerHTML = "REST IN FORCE...";
					div.appendChild(restLabel);
					removeElement("lightSabersMenu");
					removeElement("saberListMenu");
				}else{
					var seperatorAge = document.createElement("LABEL");
					seperatorAge.innerHTML = "  -  Age: ";
					seperatorAge.className = "margin-right-5";
					container.appendChild(seperatorAge);
					var ageLabel = document.createElement("LABEL");
					ageLabel.innerHTML = myObj.age;
					ageLabel.className = "margin-right-5";
					container.appendChild(ageLabel);
					var seperatorForce = document.createElement("LABEL");
					var forceLabel = document.createElement("LABEL");
					if(myObj.force < 0){
						seperatorForce.innerHTML = "  -  Force is so strong with you! it's ";
						forceLabel.innerHTML = "Unlimited";
					} else {
						seperatorForce.innerHTML = "  -  Force: ";
						forceLabel.innerHTML = myObj.force;
					}
					seperatorForce.className = "margin-right-5";
					container.appendChild(seperatorForce);
					forceLabel.className = "margin-right-5";
					container.appendChild(forceLabel);
				}
			}
		}
		xhttp.open("POST", "http://localhost:8082/" + api, true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send(data);
	}
	
	//---------------------------------------------//
	//   R E U S A B L E   C O D E S   S T A R T   //
	//---------------------------------------------//
	
	//Function to change pages (Actually it generates requested pages)
	function changeTo(page){
		clearContainer();
		document.title = "The Light Saber Shop - " + page;
		setActive(page);
		generatePage(page);
	}
	
	//Function clear the container in page
	function clearContainer(){
		document.getElementById("container").innerHTML="";
	}
	
	//For getting data as json
	function getDataJson(api) {
		var myObj, x;
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				myObj = JSON.parse(this.responseText);
			}
		};
		xhttp.open("GET", "http://localhost:8082/api/" + api);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send();
	}
	
	//For getting data as Xml !!Didnt verified that yet its working!!
	function getDataXml(api) {
		var myObj, x;
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				myObj = XML.parse(this.responseText);
			}
		};
		xhttp.open("GET", "http://localhost:8082/api/" + api);
		xhttp.setRequestHeader("Content-type", "application/xml");
		xhttp.send();
	}

	//For posting data
	function postData(api,data) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 202) {
				document.getElementById("Container").innerHTML = this.responseText+" Item Added";
			}
		};
		xhttp.open("POST", "http://localhost:8082/api/" + api, true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send(data);
	}
	
	//For updating data
	function putData(api,data) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 202) {

			}
		};
		xhttp.open("PUT", "http://localhost:8082/api/" + api, true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send(data);
	}
	
	//For deleting data
	function deleteData(api,data) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 204) {
			};
		};
		xhttp.open("DELETE", "http://localhost:8082/api/" + api, true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send(data);
	};
	
	//Removing any elements by id from page
	function removeElement(id){
		var element = document.getElementById(id);
		element.parentNode.removeChild(element);
	}
	
	//For setting menu button as active and removes active from other menu buttons
	function setActive(page){
		var pageNames = [{name:"Light Sabers",id:"lightSabersMenu"},{name:"XML File",id:"saberListMenu"},{name:"XML List",id:"saberListMenu"},
			{name:"Add New Light Saber",id:"jediMasterMenu"},{name:"Add Light Saber From File",id:"jediMasterMenu"},
			{name:"Add Light Saber With JSON",id:"jediMasterMenu"} ]; 
		var pageId="";
		for(x in pageNames){
			if(pageNames[x].id == pageId) {
				continue;
			}
			if(pageNames[x].name == page){
				document.getElementById(pageNames[x].id).className += " active";
				pageId = pageNames[x].id;
			} else {
				if(document.getElementById(pageNames[x].id).className.includes(" active")){
					document.getElementById(pageNames[x].id).className = document.getElementById(pageNames[x].id).className.replace(" active","");
				}
			}
		}
	}
	
	//---------------------------------------------//
	//     R E U S A B L E   C O D E S   E N D     //
	//---------------------------------------------//
	
</script>
</head>
<body onload="checkMenu()">
	<nav class="navbar navbar-default ">
	  <div class="container-fluid">
	    <ul id="mainMenu" class="nav navbar-nav">
	      <li id="lightSabersMenu"><a onclick='changeTo("Light Sabers")'>Light Sabers</a></li>
	      <li id="saberListMenu" class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get List Of Light Sabers<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a onclick='changeTo("XML File")'>XML File</a></li>
            <li><a onclick='changeTo("XML List")'>XML List</a></li>
          </ul>
        </li>
        <li id="jediMasterMenu" class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Jedi Master Menu<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a onclick='changeTo("Add New Light Saber")'>Add New Light Saber</a></li>
            <li><a onclick='changeTo("Add Light Sabers From File")'>Add Light Sabers From File</a></li>
            <li><a onclick='changeTo("Add Light Sabers With JSON")'>Add Light Sabers With JSON</a></li>
            <li role="separator" class="divider"></li>
            <li><a onclick='changeTo("Stock List")'>Stock List</a></li>
          </ul>
        </li>
	    </ul>
	    <ul class="nav navbar-nav navbar-right">
	      <li id="signUpMenu" ><a th:href="@{/SignUp}"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
	      <li id="loginMenu" class="dropdown">
	      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-log-in"></span> Login</a>
          <ul class="dropdown-menu">
            <li><div th:if="${param.error}">
		            Invalid username and password.
		        </div>
		        <div th:if="${param.logout}">
		            You have been logged out.
		        </div>
		        <form th:action="@{/login}" method="post">
		        	<div class="form-group margin-right-5 margin-left-5">
						<label for="DropdownFormEmail2" style="color:black">Email address</label>
						<input type="email" name="username" class="form-control" id="DropdownFormEmail2" placeholder="email@example.com">
					</div>
					<div class="form-group margin-right-5 margin-left-5">
						<label for="DropdownFormPassword2" style="color:black">Password</label>
						<input type="password" name="password" class="form-control" id="DropdownFormPassword2" placeholder="Password">
					</div>
					<div class="text-center margin-right-5 margin-left-5">
						<button type="submit" class="btn btn-default btn-lg btn-block">Sign in</button>
					</div>
		        </form>
        	</li>
          </ul>
        </li>
        <li id="logoutMenu"><a th:href="@{/logout}"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
	    </ul>
	  </div>
	  <div id="containerUser" class="container-fluid text-center navbar-inverse">
		<label id="emailLabel" th:inline="text">[[${#httpServletRequest.remoteUser}]]</label>
		</div>
	</nav>
	<div id="container" class="container-fluid">
		<div class="row text-center">
			<h2>Welcome to</h2>
        </div>
        <div class="row text-center">
			<h1>The Light Saber Shop</h1>
        </div>
        <div class="row text-center">
			<img alt="The_Light_Saber_Shop_logo" src="pictures/thelightsabershoplogo.png">
        </div>
        <div class="row text-center">
        </div>
        <div class="row text-center" style="margin-top:40px">
			<h4>Coded and Designed By</h4>
        </div>
        
        <div class="row text-center">
			<img alt="Sevket_Ozturk_logo" src="pictures/sevket_ozturk_logo.png" height="78px">
        </div>
    </div>
</body>
</html>